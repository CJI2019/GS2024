#pragma once
#include "DataBase.h"
#include "ClientInfo.h"

#define serverFramework Server::GetInstance()


class Server
{
private:
	Server();
public:
	static Server& GetInstance() {
		static Server instance; // 정적 변수로 인스턴스를 유지, 지연 초기화
		return instance;
	}
	~Server();
	static void Worker_Thread();
	static int Get_new_clientId();
	static void Accept_Logic(OVER_ALLOC* o_alloc);

	void Init();
	void Accept();

	static void Disconnect(int c_id);
	static void error_display(const char* msg, int err_no);
protected:
	static SOCKET m_Server_sock;
	static SOCKET m_cSock;
	static OVER_ALLOC m_over;
	static HANDLE m_hiocp;

	static std::array<ClientInfo, MAX_USER> m_aClientInfos;

	UINT m_iClient_count = 0; //접속한 개수가 아닌 접속했던 클라의 개수

	Sector m_Sector;
public:
	std::array<ClientInfo, MAX_USER>& GetClientInfo() { return m_aClientInfos; }

	Sector& GetSector() { return m_Sector; }
};
